# Step 1: Identify missing values
missing_data = df.isnull().sum()
missing_percentage = (missing_data / len(df)) * 100
missing_summary = pd.DataFrame({'Missing Values': missing_data, 'Percentage (%)': missing_percentage})
missing_summary = missing_summary[missing_summary['Missing Values'] > 0].sort_values(by='Percentage (%)', ascending=False)
print("Missing data summary:\n", missing_summary)



import pandas as pd
from sklearn.model_selection import train_test_split

# Load transaction files
jan_txn = pd.read_csv('jan_txn.csv')
feb_txn = pd.read_csv('feb_txn.csv')
mar_txn = pd.read_csv('mar_txn.csv')

# Get unique ACCT_NBR from all transaction files
txn_acct_nbr = pd.concat([jan_txn['ACCT_NBR'], feb_txn['ACCT_NBR'], mar_txn['ACCT_NBR']]).unique()

# Load the new CUST_NBR file (adjust filename as needed)
cust_nbr_df = pd.read_csv('cust_nbr_list.csv')  # Assumes single column 'CUST_NBR'
cust_nbr_list = cust_nbr_df['CUST_NBR'].unique()

# Load main dataset
main_df = pd.read_csv('Base_iter.csv')

# Identify CUST_NBR with transactions
txn_cust_nbr = main_df[main_df['ACCT_NBR'].isin(txn_acct_nbr)]['CUST_NBR'].unique()

# Find active CUST_NBR: intersection of transaction customers and new CUST_NBR file
active_cust_nbr = set(txn_cust_nbr).intersection(set(cust_nbr_list))

# Filter main dataset to include only accounts of active customers
filtered_df = main_df[main_df['CUST_NBR'].isin(active_cust_nbr)]

# Perform stratified sampling to get approximately 500,000 rows
n_filtered = len(filtered_df)
if n_filtered <= 500000:
    # If filtered data is less than or equal to 500,000, take all
    sampled_df = filtered_df
else:
    # Calculate sampling fraction
    sampling_fraction = 500000 / n_filtered
    # Stratified sampling by CUST_CLASS
    sampled_df, _ = train_test_split(
        filtered_df,
        train_size=sampling_fraction,
        stratify=filtered_df['CUST_CLASS'],
        random_state=42
    )

# Save the sampled dataset
output_file = 'Base_iter_sampled.csv'
sampled_df.to_csv(output_file, index=False)

print(f"Sampled dataset saved to {output_file} with {len(sampled_df)} rows.")


missing_rows = df[df.isnull().any(axis=1)]
print(missing_rows)

df.drop(index=rows_to_drop, inplace=True)


